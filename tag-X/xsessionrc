# vim: filetype=sh

# This is $HOME/.xsessionrc, a file sourced at a very early stage of
# Xsession(5). Most people won't want to use this file like this and will
# usually use $HOME/.xsession or $HOME/.Xsession instead.
#
# Using $HOME/.xsessionrc with an exec at the end allows me to skip all
# following Xsession(5) scripts which would set up numlockx, im-launch, dbus,
# gpg-agent, ssh-agent..., all stuff we wan't to do on our own so that we know
# exactly what's going on. :)
#
# The Xsession(5) scripts are a common gateway for a lot of Display Managers,
# i.e: xinit (startx), XDM, LightDM, SLiM... so by doing so we are compatible
# with them all.
# Note: for xinit to use this common gateway as well, $HOME/.xinitrc should NOT
# exist, so that startx will feed xinit with /etc/X11/xinit/xinitrc as
# 'client', script which will in turn point to Xsession(5) scripts.

FONTDIR="$HOME/.local/share/fonts"
RESOURCES="$HOME/.Xresources.ad"
RESOURCES_DIR="$HOME/.Xresources.d"

XKB_CONF="$HOME/.xkbmaprc"

xset +fp "$FONTDIR"

xset r rate 200 44

# Keyboard mapping configuration
if [ -f "$XKB_CONF" ]; then
    . $XKB_CONF
fi


if [ -f "$RESOURCES" ] && [ -d "$RESOURCES_DIR" ]; then
  xrdb -I"$RESOURCES_DIR" -load "$RESOURCES"
fi

if type keychain > /dev/null 2>&1; then
    eval `keychain --clear --noask --agents ssh,gpg --eval`
fi

# Using urxvt daemon saves RAM
urxvtd -q -o -f

xscreensaver -no-capture-stderr -log /dev/null > /dev/null 2>&1 &

if type connman-ui-gtk > /dev/null 2>&1; then
    connman-ui-gtk > /dev/null 2>&1 &
fi

if type fcitx > /dev/null 2>&1; then
    fcitx > /dev/null 2>&1
    export GTK_IM_MODULE=fcitx
    export QT_IM_MODULE=fcitx
    export XMODIFIERS=@im=fcitx
fi

if type numlockx > /dev/null 2>&1; then
    numlockx on
fi

# Disable annoying bell
xset -b

exec awesome
